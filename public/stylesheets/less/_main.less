// tile position function
.tile-pos(@n, @i: 0) when (@i =< @n) {
  &.x@{i} {
    left:  @i * @TILESIZE;
  }
  &.y@{i} {
    top: @i * @TILESIZE;
  }
  .tile-pos(@n, (@i + 1));
}

.tile-offset(@target, @n, @i: -@n) when (@i =< @n) {
  &.x@{i} {
    .@{target} {
      left: -(@i * @TILESIZE);
    }
  }
  &.y@{i} {
    .@{target} {
      top: -(@i * @TILESIZE);
    }
  }
  .tile-offset(@target, @n, (@i + 1));
}

.chunk-offset-x(@n, @i: -@n) when (@i =< @n) {
  &.cx@{i} {
    .chunk-offset-y(@n, @i);
  }
  .chunk-offset-x(@n, (@i + 1));
}
.chunk-offset-y(@n, @xi, @yi: -@n) when (@yi =< @n) {
  &.cy@{yi} {
    transform: translateX((@xi*@GRID_SIZE)) translateY((@yi*@GRID_SIZE));
  } 
  .chunk-offset-y(@n, @xi, (@yi + 1));
}

#main {
  position: absolute;
  width:  @DISPLAY_SIZE;
  height: @DISPLAY_SIZE;
  top: 0;
  left: 0;
  overflow: hidden;

  &.edit {
    overflow: auto;
  }

  .chunk {
    .clearfix;
    position: absolute;
    width: @GRID_SIZE;
    height: @GRID_SIZE;
    .chunk-offset-x(32);
  }

  .tiles,
  .elements,
  .entities {
    position: absolute;
  }
  .tiles {
    width: @GRID_SIZE;
    height: @GRID_SIZE;
    background-color: white;
    &.grass {
      background-image: url('../images/grass.png');
    }
    &.dirt {
      background-image: url('../images/dirt.png');
    }
    -webkit-transform: translate3D(0,0,0);
  }

  .tile-offset(chunk,     @CHUNKSIZE);
  .players {
    position: absolute;
    z-index: 999;
  }

}

.tile,
.entity {
  position: absolute;
  box-sizing: border-box;
}
.tile {
  .tile-pos( @CHUNKSIZE );
  width: @TILESIZE;
  height: @TILESIZE;

  &.top     { border-top:     1px solid #aaa; }
  &.left    { border-left:    1px solid #aaa; }
  &.bottom  { border-bottom:  1px solid #aaa; }
  &.right   { border-right:   1px solid #aaa; }
}


#main {
  .tiles,
  .elements,
  .entities {
    transition: top 0.125s 0.025s, left 0.125s 0.025s;
  }
}
.entity.player {
  transition: top 0.2s, left 0.2s;
}
