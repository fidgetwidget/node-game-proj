#!/usr/bin/env node
var app = require('../app');

app.set('port', process.env.PORT || 3333);

var server = app.listen( app.get('port'), function() {
    console.log('Express server listening on port ' + server.address().port);
  });

var io = require('socket.io')(server)

io.on('connection', function (socket) {

  // Joing/Leave a chunk's notifications
  socket.on('subscribe', function (data) { 
    console.log(data);
    socket.join(data.room); 
  });

  socket.on('unsubscribe', function (data) { 
    console.log(data);
    socket.leave(data.room); 
  });


  socket.on('tiles', function (data) {
    console.log(data);
    io.sockets.in(data.room).emit('tiles', data);
  });

  socket.on('elements', function(data) {
    console.log(data);
    io.sockets.in(data.room).emit('elements', data);
  });
  
});
